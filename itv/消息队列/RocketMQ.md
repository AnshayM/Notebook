# RocketMQ

阿里巴巴在2012年开源的消息队列产品，捐赠给Apache基金会。

各方面都很均衡，没有什么缺点。中国人开发，有活跃的中文社区。

RocketMQ对在线业务的响应时延做了很多优化，大多数可以做到毫秒级的响应。性能比RabbitMQ要高一个数量级。

缺点是国产的消息队列产品，国际上不太流行，与周边生态的集成和兼容度要略逊一筹。



#### 消息模型

发布-订阅模式

所有消息队列都会采用**请求-确认**的机制，确保消息再传递过程不会因为网络或者服务器故障那个丢失。

**生产端**：生产者先将消息发送给服务端(Broker)，服务端收到消息并将消息写入主题(或队列)后，会给生产者发送确认响应。如果生产者没有收到响应，就会重发消息
**消费端**：消费者收到消息并完成自己的消费业务逻辑后，会给服务端发送消费成功的确认。服务端只有收到消费确认后，才认为一条消息被成功消费。否则服务端会给消费者重新发送消息，直到收到对应的消费成功确认。

这个机制在消费端可能会引发一些问题。为确保消息有序性，某条消息被成功消费前，下一条消息是不能被消费的，否则就会出现消息空洞，违背了有序性原则。

**每个主题包含多个队列，通过多个队列来实现多实例并行生产和消费。**在队列层面保证消息的有序性。

在RocketMQ中，订阅者的概念通过消费组来体现，每个消费组消费主题中一份完整的消息。
通过如下方式，同一个消费组，可以有多个消费者同时消费一个主题中的内容，通过消费位置(offset)来保证顺序。

![](http://learn.lianglianglee.com/%E4%B8%93%E6%A0%8F/%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97%E9%AB%98%E6%89%8B%E8%AF%BE/assets/465142ab5b5096f283118c307e8cc117.jpg)