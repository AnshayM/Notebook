# 概述

## 为什么需要消息队列

**应用场景：**
发布/订阅系统实现一个微服务级系统间的观察者模式
连接流计算和数据
用于将消息广播给大量接受者

**作用**
异步处理
流量控制
服务解耦

**弊端：**
引入消息队列带来的延迟问题
增加系统的复杂度
可能产生数据不一致的问题

**1异步处理**

比如秒杀系统，需要在有限的资源里处理，尽可能处理段时间内的海量消息。

可以更快的返回结果，
减少等待，实现了步骤之间的并发，提升系统总体的性能。

**2流量控制**

如何避免过多的请求压垮我们的秒杀系统。使用消息队列隔离网关和后端服务，达到流量控制和保护后端服务的目的。

根据上下游的处理能力自动调节流量，达到削峰填谷大的作用。但是这样也会有一些弊端。
1增加系统调用链缓解，导致总体的响应时间变长
2上下游都要将同步调用改为异步调用，增加系统的复杂度。

令牌桶控制流量：单位时间只发放固定数量的令牌到令牌桶中，规定服务在处理请求之前必须先从令牌桶中拿出一个令牌，如果令牌桶中没有，则拒绝请求。保证单位时间处理的请求数量不超过令牌桶的数量，达到流量控制的作用。

![](http://learn.lianglianglee.com/%E4%B8%93%E6%A0%8F/%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97%E9%AB%98%E6%89%8B%E8%AF%BE/assets/2c4e42056b78fff7746de28245910f89.jpg)



不破坏原有调用链，只在网关处理客户端请求时增加一个获取令牌的逻辑。
令牌桶可以简单用一个固定容量的消息队列+令牌发生器实现。令牌发生器预估当前处理能力，均匀产生令牌放入令牌队列（满则丢弃）。

**3服务解耦**

实现应用之间的服务解耦，上下游需求变化时不会影响到另一方。



## 合格的消息队列产品

消息可靠性：确保不丢消息
Cluster：支持集群，确保不会因为某个节点宕机导致服务不可用，也不能丢消息
性能：具备足够好的性能，能满足大多数场景的性能要求。









## 背景问题



#### 如何设计一个秒杀系统

