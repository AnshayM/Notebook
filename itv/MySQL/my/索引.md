### B 树& B+树

B 树也称 B-树,全称为 **多路平衡查找树** ，B+ 树是 B 树的一种变体。

目前大部分数据库系统及文件系统都采用 B-Tree 或其变种 B+Tree 作为索引结构。
Mysql的InnoDb使用B+树，Oracle使用的是B树

**B 树& B+树两者有何异同**

B+树与B树的根本差异在于，B+ 树的中间节点并不直接存储数据 

- **B+ 树查询效率更稳定**。因为 B+ 树每次只有访问到叶子节点才能找到对应的数据，而在 B 树中，非叶子节点也会存储数据，这样就会造成查询效率不稳定的情况，有时候访问到了非叶子节点就可以找到关键字，而有时需要访问到叶子节点才能找到关键字。
- **关键字查询上，B+ 树的查询效率更高**。这是因为通常 B+ 树比 B 树更矮胖（阶数更大，深度更低），查询所需要的磁盘 I/O 也会更少。同样的磁盘页大小，B+ 树可以存储更多的节点关键字。
- **查询范围上，B+ 树的效率也比B树高**。这是因为所有关键字都出现在 B+ 树的叶子节点中，并通过有序链表进行了链接。而在 B 树中则需要通过中序遍历才能完成查询范围的查找，效率要低很多。

B+树只需要使用O(logN)找到最小的结点，然后通过链进行O(N)的顺序遍历即可，而B树需要对树的每一层进行遍历，这会需要更多的内存置换次数，也就需要更多的时间。

B树(Balance Tree)：平衡多路搜索树，高度远小于平衡二叉树的高度
![B树.png](https://s1.328888.xyz/2022/05/14/qdFJS.png)
B+树针对B树做了一定的改进
![B+树](https://s1.328888.xyz/2022/05/14/qdVzR.png)

#### 索引失效的情况

在where条件中使用函数、or的一个条件里没有索引、使用like后两边都用%号修饰。(单边时需要用explain来分析)
最左原则，需要从第一个开始，遇到范围查询会停止匹配。(sql优化器会将>、<自动放到最后面)

##### 建立索引需要注意什么

左前缀
较频繁作为查询条件的才去创建索引
更新频繁的字段不适合创建索引
不能有效区分数据的不适合
尽量的扩展索引，不要新建索引
非空字段，应该指定列尾notNULL
索引字段越小越好，这样同一个16K页里存储的数据更多，同样的查询IO次数更少

**在大表(百万级别)操作注意点**
在删除百万数据时，可以先删除索引，然后删除无用数据，删除完毕后重新创建数据
这样操作绝对比直接删除数据要快速。并且可以防止删除中断、回滚的问题。

#### 聚簇索引（或聚集索引）和非聚簇索引

主键索引就是一个聚簇索引，叶子结点中存储的就是对应的数据，直接取出即可。非聚簇索引保存的是对应主键的地址，需要回表才能取到对应的数据。

在查询的值就是索引里包含的值时，不需要回表。



#### 检查sql是否走索引

explain sql------type会展示对应的值
慢查询

参考文章](https://www.cnblogs.com/wqbin/p/12124621.html)